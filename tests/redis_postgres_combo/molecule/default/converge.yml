---
- name: Converge redis + postgres combo
  hosts: all
  become: true
  vars:
    redis_combo_password: "{{ hostvars[inventory_hostname].combo_redis_password }}"
    combo_db_name: "{{ hostvars[inventory_hostname].combo_postgres_db }}"
    combo_db_password: "{{ hostvars[inventory_hostname].combo_postgres_password }}"
  roles:
    - role: redis_install
      vars:
        redis_install_requirepass_enabled: true
        redis_install_password: "{{ redis_combo_password }}"
    - role: postgres_install
      vars:
        postgres_install_databases:
          - name: "{{ combo_db_name }}"
            owner: combo
        postgres_install_users:
          - name: combo
            password: "{{ combo_db_password }}"
