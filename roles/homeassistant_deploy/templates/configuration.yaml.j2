# Home Assistant Configuration
# Generated by Ansible deployment

# Basic configuration
homeassistant:
  name: {{ homeassistant_name }}
  latitude: {{ homeassistant_latitude }}
  longitude: {{ homeassistant_longitude }}
  elevation: {{ homeassistant_elevation }}
  unit_system: {{ homeassistant_unit_system }}
  time_zone: {{ homeassistant_time_zone }}
  country: {{ homeassistant_country }}
  currency: {{ homeassistant_currency }}
{% if homeassistant_external_url %}
  external_url: {{ homeassistant_external_url }}
{% endif %}
{% if homeassistant_internal_url %}
  internal_url: {{ homeassistant_internal_url }}
{% endif %}
  
# HTTP configuration for reverse proxy
http:
  server_host: {{ homeassistant_host }}
  server_port: {{ homeassistant_app_port }}
  use_x_forwarded_for: true
  trusted_proxies:
{% for proxy in homeassistant_trusted_proxies %}
    - {{ proxy }}
{% endfor %}
  ip_ban_enabled: true
  login_attempts_threshold: 5

# Database configuration
recorder:
  db_url: {{ homeassistant_db_url }}
  purge_keep_days: {{ homeassistant_recorder_keep_days }}
  commit_interval: {{ homeassistant_recorder_commit_interval }}
  exclude:
    domains:
      - automation
      - updater
    entity_globs:
      - sensor.weather_*
    entities:
      - sun.sun
      - sensor.date

# Logger configuration
logger:
  default: {{ homeassistant_logger_default }}
  logs:
{% for component, level in homeassistant_logger_logs.items() %}
    {{ component }}: {{ level }}
{% endfor %}

# Enable the frontend
frontend:
  themes: !include_dir_merge_named themes

# Enable configuration UI
config:

# System Health
system_health:

# Lovelace UI
lovelace:
  mode: storage
  dashboards:
    lovelace-generated:
      mode: yaml
      filename: notexist.yaml
      title: Generated
      icon: mdi:tools
      show_in_sidebar: true
      require_admin: true

# Mobile app support
mobile_app:

# Person tracking
person:

# Sun tracking
sun:

# System monitor
system_monitor:
  process:
    - python3
  resources:
    - type: disk_use_percent
      arg: /
    - type: memory_free
    - type: memory_use_percent
    - type: processor_use
    - type: processor_temperature
    - type: last_boot

# Enable support for tracking state changes
history:

# Enable logging of events
logbook:


# Weather (you can configure your preferred weather provider)
weather:
  - platform: met
    name: Home

# Text to speech
tts:
  - platform: google_translate

# Cloud (optional - comment out if not using Home Assistant Cloud)
# cloud:

# Automations (stored in automations.yaml)
automation: !include automations.yaml

# Scripts (stored in scripts.yaml)
script: !include scripts.yaml

# Scenes (stored in scenes.yaml)
scene: !include scenes.yaml

# Groups (stored in groups.yaml)
group: !include groups.yaml

# Zones
zone:
  - name: Home
    latitude: {{ homeassistant_latitude }}
    longitude: {{ homeassistant_longitude }}
    radius: 100
    icon: mdi:home

# Default integrations
default_config:

# Discovery
discovery:
  ignore:
    - sonos
    - samsung_tv

# MQTT (optional - uncomment if you have an MQTT broker)
# mqtt:
#   broker: 127.0.0.1
#   port: 1883
#   username: homeassistant
#   password: !secret mqtt_password

# Z-Wave (optional - uncomment if you have Z-Wave devices)
# zwave:
#   usb_path: /dev/ttyUSB0

# Zigbee (optional - uncomment if you have Zigbee devices)
# zha:
#   usb_path: /dev/ttyUSB1
#   database_path: {{ homeassistant_data_path }}/zigbee.db

# UniFi Network Integration 
# NOTE: UniFi must be configured through the UI, not YAML
# Go to Settings → Devices & Services → Add Integration → UniFi Network
# Use these credentials:
#   Host: {{ homeassistant_unifi_host }}
#   Port: {{ homeassistant_unifi_port }}
#   Username: {{ homeassistant_unifi_username }}
#   Password: (from secrets.yaml unifi_password)
#   Site: {{ homeassistant_unifi_site }}
