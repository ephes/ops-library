---
- name: Unload existing launchd service
  ansible.builtin.command: "launchctl bootout system {{ ollama_launchd_plist_path }}"
  failed_when: false
  changed_when: false
  listen: Restart Ollama launchd service
  become: true

- name: Bootstrap launchd service
  ansible.builtin.command: "launchctl bootstrap system {{ ollama_launchd_plist_path }}"
  register: ollama_launchd_bootstrap
  changed_when: ollama_launchd_bootstrap.rc == 0
  listen: Restart Ollama launchd service
  become: true

- name: Enable launchd service
  ansible.builtin.command: "launchctl enable system/{{ ollama_launchd_label }}"
  register: ollama_launchd_enable
  changed_when: ollama_launchd_enable.rc == 0
  listen: Restart Ollama launchd service
  become: true

- name: Kickstart launchd service
  ansible.builtin.command: "launchctl kickstart -k system/{{ ollama_launchd_label }}"
  register: ollama_launchd_kickstart
  changed_when: ollama_launchd_kickstart.rc == 0
  listen: Restart Ollama launchd service
  become: true
