---
- name: env | Assemble OpenClaw environment
  ansible.builtin.set_fact:
    openclaw_env: "{{ openclaw_env_defaults | combine(openclaw_extra_env, recursive=True) }}"
  no_log: true
  vars:
    openclaw_env_defaults:
      OPENCLAW_GATEWAY_TOKEN: "{{ openclaw_gateway_token }}"
      ANTHROPIC_API_KEY: "{{ openclaw_anthropic_api_key }}"
      TELEGRAM_BOT_TOKEN: "{{ openclaw_telegram_bot_token }}"
      NODE_OPTIONS: "--max-old-space-size={{ openclaw_node_max_old_space_size }}"

- name: env | Render OpenClaw environment file
  ansible.builtin.template:
    src: openclaw.env.j2
    dest: "{{ openclaw_site_dir }}/.env"
    owner: root
    group: root
    mode: "0600"
  no_log: true
  notify: restart openclaw
