---
- name: Assemble Open WebUI environment
  ansible.builtin.set_fact:
    open_webui_env: "{{ open_webui_env_defaults | combine(open_webui_extra_env, recursive=True) }}"
  vars:
    open_webui_env_defaults:
      OLLAMA_BASE_URL: "{{ open_webui_ollama_base_url }}"
      WEBUI_SECRET_KEY: "{{ open_webui_webui_secret_key }}"
      WEBUI_AUTH: "{{ open_webui_webui_auth_enabled | ternary('true', 'false') }}"
      OPENAI_API_KEY: "{{ open_webui_openai_api_key }}"
      OPENAI_API_BASE_URL: "{{ open_webui_openai_api_base_url }}"

- name: Render Open WebUI environment file
  ansible.builtin.template:
    src: open-webui.env.j2
    dest: "{{ open_webui_env_file }}"
    owner: root
    group: root
    mode: "0600"
  no_log: true
  notify: restart open webui
