---
- name: Validate required variables
  ansible.builtin.import_tasks: validate.yml

- name: Ensure Docker is installed
  ansible.builtin.import_tasks: docker.yml
  when: telegram_bot_install_docker | bool

- name: Ensure Telegram Bot user exists
  ansible.builtin.import_tasks: user.yml
  when: telegram_bot_manage_user | bool

- name: Ensure Telegram Bot directories exist
  ansible.builtin.import_tasks: directories.yml

- name: Render bot application and install dependencies
  ansible.builtin.import_tasks: app.yml

- name: Render Telegram Bot environment file
  ansible.builtin.import_tasks: env.yml

- name: Render Telegram Bot Docker Compose file
  ansible.builtin.import_tasks: compose.yml

- name: Configure Telegram Bot systemd service
  ansible.builtin.import_tasks: systemd.yml

- name: Apply pending handlers before health checks
  ansible.builtin.meta: flush_handlers

- name: Run Telegram Bot health check
  ansible.builtin.import_tasks: health.yml
  when: telegram_bot_healthcheck_enabled | bool
