---
# Handlers for mail_backend_deploy
# All handlers skip in check mode since services won't be installed

- name: Restart postfix
  ansible.builtin.systemd:
    name: postfix
    state: restarted
    daemon_reload: true
  when: not ansible_check_mode

- name: Reload postfix
  ansible.builtin.command: postfix reload
  changed_when: true
  when: not ansible_check_mode

- name: Restart dovecot
  ansible.builtin.systemd:
    name: dovecot
    state: restarted
    daemon_reload: true
  when: not ansible_check_mode

- name: Restart opendkim
  ansible.builtin.systemd:
    name: opendkim
    state: restarted
    daemon_reload: true
  when: not ansible_check_mode

- name: Postmap relay_password
  ansible.builtin.command: postmap /etc/postfix/relay_password
  changed_when: true
  notify: Reload postfix
  when: not ansible_check_mode
