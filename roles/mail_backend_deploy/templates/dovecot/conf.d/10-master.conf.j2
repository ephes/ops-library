# Dovecot master process configuration
# Generated by Ansible - do not edit manually
# Role: mail_backend_deploy

# =============================================================================
# IMAP Service
# =============================================================================
service imap-login {
  inet_listener imap {
    # Disable unencrypted IMAP
    port = 0
  }
  inet_listener imaps {
    port = 993
    ssl = yes
  }
}

service imap {
  # Most of the memory goes to mmap()ing files
  vsz_limit = 256M
}

# =============================================================================
# LMTP Service (for Postfix delivery)
# =============================================================================
service lmtp {
  unix_listener /var/spool/postfix/private/dovecot-lmtp {
    mode = 0600
    user = postfix
    group = postfix
  }
}

# =============================================================================
# Authentication Service
# =============================================================================
service auth {
  # Postfix SMTP AUTH
  unix_listener /var/spool/postfix/private/auth {
    mode = 0666
    user = postfix
    group = postfix
  }

  # Auth workers for SQL lookups
  unix_listener auth-userdb {
    mode = 0600
    user = {{ mail_backend_vmail_user }}
    group = {{ mail_backend_vmail_group }}
  }
}

service auth-worker {
  user = {{ mail_backend_vmail_user }}
}

# =============================================================================
# ManageSieve Service
# =============================================================================
{% if mail_backend_sieve_enabled %}
service managesieve-login {
  inet_listener sieve {
    port = 4190
  }
}

service managesieve {
}
{% endif %}
