# Dovecot SQL authentication configuration
# Generated by Ansible - do not edit manually
# Role: mail_backend_deploy

driver = pgsql
connect = host={{ mail_backend_postgres_host }} dbname={{ mail_backend_postgres_database }} user={{ mail_backend_postgres_user }} password={{ mail_backend_postgres_password }}

default_pass_scheme = {{ mail_backend_password_scheme }}

# Password query - authenticate user
password_query = \
  SELECT email AS user, password \
  FROM mail_users_view \
  WHERE LOWER(email) = LOWER('%u')

# User query - get maildir location
user_query = \
  SELECT \
    '{{ mail_backend_vmail_path }}/' || maildir AS home, \
    '{{ mail_backend_vmail_path }}/' || maildir AS mail, \
    {{ mail_backend_vmail_uid }} AS uid, \
    {{ mail_backend_vmail_gid }} AS gid \
  FROM mail_users_view \
  WHERE LOWER(email) = LOWER('%u')

# Iterate query - list all users (for doveadm operations)
iterate_query = SELECT email AS user FROM mail_users_view
