# Postfix PostgreSQL lookup - Domain aliases (expanded)
# Generated by Ansible - do not edit manually
# Schema mode: {{ mail_backend_schema_mode }}

user = {{ mail_backend_postgres_user }}
password = {{ mail_backend_postgres_password }}
hosts = {{ mail_backend_postgres_host }}
dbname = {{ mail_backend_postgres_database }}

{% if mail_backend_schema_mode == 'postfixadmin' %}
# PostfixAdmin alias_domain: resolves user@alias_domain to user@target_domain
# Only returns a result if the recipient exists in alias table on target domain
# This prevents accepting mail for non-existent users (backscatter protection)
query = SELECT a.goto FROM alias_domain ad JOIN alias a ON LOWER(a.address) = LOWER(CONCAT('%u', '@', ad.target_domain)) WHERE LOWER(ad.alias_domain) = LOWER('%d') AND ad.active = '1' AND a.active = '1'
{% else %}
query = SELECT destination FROM mail_domain_aliases_expanded WHERE LOWER(source) = LOWER('%s')
{% endif %}
