---
# Default variables for Home Assistant backup role

# Root directory where backups will be stored on the target host
homeassistant_backup_root: /opt/backups/homeassistant

# Prefix used when creating the backup directory (e.g. manual, auto, ci)
homeassistant_backup_prefix: manual

# Paths to back up (can be customised if installation layout differs)
homeassistant_config_path: /home/homeassistant/site/config
homeassistant_data_path: /home/homeassistant/site/data
homeassistant_logs_path: /home/homeassistant/site/logs
homeassistant_backup_sqlite_path: "{{ homeassistant_config_path }}/home-assistant_v2.db"
homeassistant_backup_use_sqlite_backup: true

# Matter/Thread state paths (used for optional backups)
homeassistant_matter_server_storage_path: "{{ homeassistant_data_path }}/matter-server"
homeassistant_matter_server_chip_factory_dir: /data
homeassistant_backup_otbr_state_path: /var/lib/thread

# Optional extra directories to snapshot (skipped when include=false)
homeassistant_backup_extra_dirs:
  - name: thread
    src: "{{ homeassistant_backup_otbr_state_path }}"
    optional: true
    include: true
  - name: matter-server
    src: "{{ homeassistant_matter_server_storage_path }}"
    optional: true
    include: >-
      {{ not (homeassistant_matter_server_storage_path == homeassistant_data_path or
              homeassistant_matter_server_storage_path.startswith(homeassistant_data_path ~ '/')) }}
  - name: matter-chip-factory
    src: "{{ homeassistant_matter_server_chip_factory_dir }}"
    optional: true
    include: >-
      {{ (homeassistant_matter_server_chip_factory_dir | length > 0)
         and (homeassistant_matter_server_chip_factory_dir != '/data')
         and (not homeassistant_matter_server_chip_factory_dir.startswith(homeassistant_data_path ~ '/')) }}

# Additional files to capture
homeassistant_service_unit_path: /etc/systemd/system/homeassistant.service
homeassistant_traefik_config_path: /etc/traefik/dynamic/homeassistant.yml

# Whether to include logs in backups (helpful for post-restore debugging)
homeassistant_backup_include_logs: true

# Whether to run rsync with --delete to keep backups in sync with source dirs
homeassistant_backup_use_delete: true

# Generate sha256 manifest for all files in the backup directory
homeassistant_backup_generate_checksums: true

# Create compressed archive after snapshot (set to false to skip)
homeassistant_backup_create_archive: true

# Archive format (currently only tar.gz supported)
homeassistant_backup_archive_format: tar.gz

# Fetch the generated archive back to the control machine
homeassistant_backup_fetch_local: true

# Local directory (on control machine) where archives are stored
homeassistant_backup_local_dir: "{{ lookup('env', 'HOME') }}/backups/homeassistant"

# File mode for created local directories
homeassistant_backup_local_dir_mode: '0750'

# Owner/group for created backup directories
homeassistant_backup_owner: root
homeassistant_backup_group: root

# File mode for copied single files
homeassistant_backup_file_mode: '0644'

# Directory mode for created backup directories
homeassistant_backup_dir_mode: '0750'
