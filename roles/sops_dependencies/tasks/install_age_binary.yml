---
- name: Download age binary
  get_url:
    url: "https://github.com/FiloSottile/age/releases/download/v{{ sops_deps_age_version }}/age-v{{ sops_deps_age_version }}-linux-amd64.tar.gz"
    dest: "/tmp/age.tar.gz"
    mode: '0644'
  become: true

- name: Extract age binary
  unarchive:
    src: "/tmp/age.tar.gz"
    dest: "/tmp"
    remote_src: yes
  become: true

- name: Install age binaries
  copy:
    src: "/tmp/age/{{ item }}"
    dest: "/usr/local/bin/{{ item }}"
    mode: '0755'
    remote_src: yes
  loop:
    - age
    - age-keygen
  become: true

- name: Clean up age download
  file:
    path: "{{ item }}"
    state: absent
  loop:
    - /tmp/age.tar.gz
    - /tmp/age
  become: true