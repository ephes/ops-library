---
- name: reload systemd
  ansible.builtin.systemd:
    daemon_reload: true

- name: restart jellyfin
  ansible.builtin.systemd:
    name: "{{ jellyfin_service_name }}"
    state: restarted
    enabled: "{{ jellyfin_service_enabled }}"

- name: reload traefik
  ansible.builtin.service:
    name: traefik
    state: reloaded
  failed_when: false
  register: jellyfin_traefik_reload

- name: warn when Traefik reload failed
  ansible.builtin.debug:
    msg: "Traefik reload failed (rc={{ jellyfin_traefik_reload.rc | default('n/a') }}). Check Traefik logs and dynamic config."
  when: (jellyfin_traefik_reload.rc | default(0)) != 0

- name: restart traefik when reload unsupported
  ansible.builtin.service:
    name: traefik
    state: restarted
  when:
    - jellyfin_traefik_reload.rc is defined
    - jellyfin_traefik_reload.rc != 0
