# Vaultwarden Configuration
# Managed by Ansible - DO NOT EDIT MANUALLY
# https://github.com/dani-garcia/vaultwarden/wiki/Configuration-overview

# ===================
# General Settings
# ===================

# The domain where Vaultwarden is accessible
DOMAIN={{ vaultwarden_domain }}

# Rocket (web server) settings
ROCKET_ADDRESS={{ vaultwarden_rocket_address }}
ROCKET_PORT={{ vaultwarden_rocket_port }}

# Data directory (set by deb package)
DATA_FOLDER=/var/lib/vaultwarden/data

# Web vault location (deb package installs to /usr/share/vaultwarden/web-vault)
WEB_VAULT_FOLDER=/usr/share/vaultwarden/web-vault
WEB_VAULT_ENABLED=true

# ===================
# WebSocket Settings
# ===================

WEBSOCKET_ENABLED={{ vaultwarden_websocket_enabled | lower }}
{% if vaultwarden_websocket_enabled %}
WEBSOCKET_ADDRESS={{ vaultwarden_rocket_address }}
WEBSOCKET_PORT={{ vaultwarden_websocket_port }}
{% endif %}

# ===================
# Registration & Invitations
# ===================

# Disable public registration (use invitations instead)
SIGNUPS_ALLOWED={{ vaultwarden_signups_allowed | lower }}

# Allow existing users to invite new users
INVITATIONS_ALLOWED={{ vaultwarden_invitations_allowed | lower }}

# Show password hints (security risk if enabled)
SHOW_PASSWORD_HINT={{ vaultwarden_show_password_hint | lower }}

# Who can create organizations: all, none, or comma-separated emails
ORG_CREATION_USERS={{ vaultwarden_org_creation_users }}

# ===================
# Admin Panel
# ===================

{% if vaultwarden_admin_enabled | bool and vaultwarden_admin_token %}
# Access admin panel at /admin with this token
# SECURITY: Set vaultwarden_admin_enabled=false after initial setup to disable
ADMIN_TOKEN={{ vaultwarden_admin_token }}
{% else %}
# Admin panel disabled (vaultwarden_admin_enabled={{ vaultwarden_admin_enabled }})
# To re-enable: set vaultwarden_admin_enabled=true and provide admin_token
# ADMIN_TOKEN=
{% endif %}

# ===================
# SMTP Configuration
# ===================

{% if vaultwarden_smtp_host %}
SMTP_HOST={{ vaultwarden_smtp_host }}
SMTP_PORT={{ vaultwarden_smtp_port }}
SMTP_SECURITY={{ vaultwarden_smtp_security }}
SMTP_FROM={{ vaultwarden_smtp_from }}
SMTP_FROM_NAME={{ vaultwarden_smtp_from_name }}
{% if vaultwarden_smtp_username %}
SMTP_USERNAME={{ vaultwarden_smtp_username }}
SMTP_PASSWORD={{ vaultwarden_smtp_password }}
# Authentication mechanism: Plain, Login, or Xoauth2
SMTP_AUTH_MECHANISM={{ vaultwarden_smtp_auth_mechanism | default('Plain') }}
{% endif %}
{% if vaultwarden_smtp_accept_invalid_certs | default(false) %}
# Accept invalid/self-signed certs (needed for localhost with domain cert)
SMTP_ACCEPT_INVALID_CERTS=true
{% endif %}
{% if vaultwarden_smtp_accept_invalid_hostnames | default(false) %}
# Accept hostname mismatch (needed when connecting to localhost but cert is for domain)
SMTP_ACCEPT_INVALID_HOSTNAMES=true
{% endif %}
{% if vaultwarden_smtp_debug | default(false) %}
# Enable SMTP debug logging
SMTP_DEBUG=true
{% endif %}
{% else %}
# SMTP not configured - invitations and 2FA recovery emails will not work
# SMTP_HOST=
{% endif %}

# ===================
# Features
# ===================

# Bitwarden Send (secure sharing)
SENDS_ALLOWED={{ vaultwarden_sends_allowed | lower }}

# Emergency access (trusted contacts)
EMERGENCY_ACCESS_ALLOWED={{ vaultwarden_emergency_access_allowed | lower }}

# Icon service for website favicons
ICON_SERVICE={{ vaultwarden_icon_service }}

# ===================
# Experimental Features
# ===================

{% if vaultwarden_experimental_client_feature_flags %}
# Enable SSH key vault items and agent
EXPERIMENTAL_CLIENT_FEATURE_FLAGS={{ vaultwarden_experimental_client_feature_flags }}
{% endif %}

# ===================
# Logging
# ===================

LOG_LEVEL={{ vaultwarden_log_level }}
LOG_FILE=/var/log/vaultwarden/vaultwarden.log
USE_SYSLOG=false

# Extended logging for debugging (uncomment if needed)
# EXTENDED_LOGGING=true
# LOG_TIMESTAMP_FORMAT=%Y-%m-%d %H:%M:%S.%3f
