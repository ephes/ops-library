---
# FastDeploy deployment role defaults
# These are safe defaults that can be public
# Sensitive values should be overridden in ops-control

# User and paths
fastdeploy_user: fastdeploy
fastdeploy_group: "{{ fastdeploy_user }}"
fastdeploy_home: "/home/{{ fastdeploy_user }}"
fastdeploy_site_path: "{{ fastdeploy_home }}/site"
fastdeploy_services_path: "{{ fastdeploy_site_path }}/services"
fastdeploy_venv_path: "{{ fastdeploy_site_path }}/.venv"
fastdeploy_venv_bin: "{{ fastdeploy_venv_path }}/bin"

# Deployment method
fastdeploy_deploy_method: rsync  # Options: rsync, git

# Source code location for rsync method (must be provided when using rsync)
# This is the local path to the fastdeploy source code
fastdeploy_source_path: ""  # REQUIRED for rsync - e.g., /path/to/your/fastdeploy

# Git repository settings (for git deployment method)
fastdeploy_git_repo: "https://github.com/ephes/fastdeploy.git"
fastdeploy_git_version: main
fastdeploy_git_dest: "{{ fastdeploy_site_path }}"

# Application settings
fastdeploy_app_port: 9999
fastdeploy_app_host: "127.0.0.1"
fastdeploy_environment: production

# PostgreSQL settings (forwarded to postgres_install dependency)
fastdeploy_postgres_version: "17"
fastdeploy_postgres_database: fastdeploy
fastdeploy_postgres_user: fastdeploy
# REQUIRED - Must be provided, no default for security
# fastdeploy_postgres_password: ""
fastdeploy_postgres_host: localhost
fastdeploy_postgres_port: 5432
fastdeploy_postgres_become_user: postgres
fastdeploy_postgres_packages:
  - "postgresql-{{ fastdeploy_postgres_version }}"
  - "postgresql-client-{{ fastdeploy_postgres_version }}"
  - "postgresql-contrib-{{ fastdeploy_postgres_version }}"
  - libpq-dev
fastdeploy_postgres_repo_enabled: true
fastdeploy_postgres_repo_url: https://apt.postgresql.org/pub/repos/apt
fastdeploy_postgres_repo_codename: "{{ ansible_distribution_release | default('jammy') }}"
fastdeploy_postgres_repo_components:
  - main
fastdeploy_postgres_repo_keyring: /etc/apt/keyrings/postgresql.asc
fastdeploy_postgres_repo_key_url: https://www.postgresql.org/media/keys/ACCC4CF8.asc

# API and frontend URLs
fastdeploy_api_url: "https://deploy.example.com"  # Override with real URL
fastdeploy_websocket_url: "wss://deploy.example.com/deployments/ws"

# Initial admin user
fastdeploy_initial_user: "admin"
# REQUIRED - Must be provided (bcrypt hash), no default for security
# fastdeploy_initial_password_hash: ""

# Secret key for sessions
# REQUIRED - Must be provided (generate with openssl rand -hex 32), no default for security
# fastdeploy_secret_key: ""

# Node.js and npm
fastdeploy_nodejs_version: 24  # Major version for Node.js (LTS)
fastdeploy_build_frontend: true

# Systemd service
fastdeploy_service_name: fastdeploy
fastdeploy_service_restart_on_failure: true
fastdeploy_service_restart_sec: 5

# Traefik integration
fastdeploy_traefik_enabled: true
fastdeploy_traefik_host: "{{ fastdeploy_api_url | regex_replace('^https?://', '') }}"
fastdeploy_traefik_cert_resolver: letsencrypt
fastdeploy_traefik_middlewares: []  # Custom middlewares to add

# Traefik dual router authentication (SECURITY: mandatory for public-facing services)
fastdeploy_basic_auth_enabled: true  # Follows security policy - dual router pattern
fastdeploy_basic_auth_user: "admin"
# REQUIRED when basic_auth_enabled=true - Must be provided, no default for security
# fastdeploy_basic_auth_password: "CHANGEME"

# Internal network IP ranges (for dual router pattern)
# These clients bypass basic auth (internal router)
fastdeploy_internal_ip_ranges:
  - "192.168.0.0/16"      # RFC1918 private
  - "10.0.0.0/8"          # RFC1918 private
  - "172.16.0.0/12"       # RFC1918 private
  - "100.64.0.0/10"       # Tailscale CGNAT
  - "fd7a:115c:a1e0::/48" # Tailscale IPv6
  - "fd50:3e45:c454:0::/64" # ULA IPv6
  - "2a02:3100:3d40:9c00::/64" # ISP IPv6 (customize per deployment)

# rsync options for deployment
fastdeploy_rsync_excludes:
  - ".git"
  - "__pycache__"
  - "*.pyc"
  - ".env"
  - ".venv"
  - "venv"
  - "databases"
  - "frontend/node_modules"
  - "frontend/dist"
  - ".mypy_cache"
  - ".pytest_cache"  
  - ".ruff_cache"
  - "htmlcov"
  - "site"
  - ".DS_Store"

# Feature flags
fastdeploy_create_initial_user: true
fastdeploy_sync_services: true
fastdeploy_install_uv: true

# uv installation settings (used when fastdeploy_install_uv is true)
fastdeploy_uv_install_dir: /usr/local/bin
fastdeploy_uv_binary: "{{ fastdeploy_uv_install_dir }}/uv"
