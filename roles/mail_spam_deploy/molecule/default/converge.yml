---
- name: Converge
  hosts: all
  become: true

  pre_tasks:
    - name: Ensure Ansible remote tmp exists
      ansible.builtin.file:
        path: /tmp/.ansible/tmp
        state: directory
        mode: "0700"

    - name: Install Postfix for milter integration
      ansible.builtin.apt:
        name: postfix
        state: present
        update_cache: true

  vars:
    mail_spam_install_redis: true
    mail_spam_web_enabled: false
    mail_spam_milter_socket_dir: "/var/spool/postfix/rspamd"

  roles:
    - role: mail_spam_deploy
