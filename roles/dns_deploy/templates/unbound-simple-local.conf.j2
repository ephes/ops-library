server:
  access-control-view: 127.0.0.0/8 "lan"
  access-control-view: {{ dns_split_lan_network | default('192.168.0.0/16') }} "lan"
  access-control-view: {{ dns_split_tailscale_network | default('100.64.0.0/10') }} "tailscale"

view:
  name: "lan"
  view-first: yes

  # Use redirect zone for wildcard catch-all
  local-zone: "{{ dns_local_domain }}." redirect
  local-zone: "{{ dns_local_domain_punycode }}." redirect

  # Redirect target - all undefined subdomains go here
  local-data: "{{ dns_local_domain }}. IN A {{ dns_local_ip }}"
  local-data: "{{ dns_local_domain_punycode }}. IN A {{ dns_local_ip }}"

{% if dns_custom_entries %}
  # Specific host overrides using static zones (these override the redirect)
{% for entry in dns_custom_entries %}
  local-zone: "{{ entry.name }}." static
  local-data: "{{ entry.name }}. IN A {{ entry.ip }}"
{% if dns_local_domain in entry.name %}
  {% set puny = entry.name | replace(dns_local_domain, dns_local_domain_punycode) %}
  local-zone: "{{ puny }}." static
  local-data: "{{ puny }}. IN A {{ entry.ip }}"
{% endif %}
{% endfor %}
{% endif %}

view:
  name: "tailscale"
  view-first: yes

  # Use redirect zone for wildcard catch-all
  local-zone: "{{ dns_local_domain }}." redirect
  local-zone: "{{ dns_local_domain_punycode }}." redirect

  # Redirect target - all undefined subdomains go here
  local-data: "{{ dns_local_domain }}. IN A {{ dns_split_tailscale_ip | default(dns_local_ip, true) }}"
  local-data: "{{ dns_local_domain_punycode }}. IN A {{ dns_split_tailscale_ip | default(dns_local_ip, true) }}"

{% if dns_custom_entries %}
  # Specific host overrides using static zones (these override the redirect)
{% for entry in dns_custom_entries %}
  local-zone: "{{ entry.name }}." static
  local-data: "{{ entry.name }}. IN A {{ dns_split_tailscale_ip | default(entry.ip, true) }}"
{% if dns_local_domain in entry.name %}
  {% set puny = entry.name | replace(dns_local_domain, dns_local_domain_punycode) %}
  local-zone: "{{ puny }}." static
  local-data: "{{ puny }}. IN A {{ dns_split_tailscale_ip | default(entry.ip, true) }}"
{% endif %}
{% endfor %}
{% endif %}
