---
# DNS Deploy Role - Default Variables
# Unbound-only DNS with split-horizon views and ad blocking

# Clean install options
dns_clean_install: false  # Set to true to remove existing DNS configs
dns_backup_existing: true  # Set to false to skip backing up existing configs

# DNS Configuration
dns_local_domain: "home.example.com"
dns_local_domain_punycode: "home.example.com"  # Same if no special chars
dns_local_ip: "{{ ansible_default_ipv4.address }}"

# DNS Mode Configuration
# - 'simple': Single IP for all clients (basic setup with Unbound only on port 53)
# - 'advanced': Split-DNS with different IPs per network (Unbound with split-horizon views)
# - 'unbound_only': DEPRECATED - Legacy alias that maps to 'advanced' mode
dns_mode: "simple"

# Unbound configuration
dns_unbound_port: 53  # Port for Unbound DNS server (53 for simple mode, custom for advanced)
dns_unbound_config_dir: /etc/unbound/unbound.conf.d
dns_unbound_blocklist_dir: /var/lib/unbound

# Split-DNS Configuration
dns_split_lan_network: "192.168.0.0/16"        # Default LAN network range
dns_split_tailscale_network: "100.64.0.0/10"   # Default Tailscale network range
dns_split_lan_ip: "{{ ansible_default_ipv4.address }}"
dns_split_tailscale_ip: ""  # MUST be set if using split-DNS
dns_split_tailscale_ipv6: ""  # Optional IPv6 address

# Service overrides for split-DNS
# Each service can have different IPs for LAN vs Tailscale clients
dns_split_services: []
#  - name: "router"
#    lan_ip: "192.168.1.1"
#    tailscale_ip: "192.168.1.1"
#  - name: "nas"
#    lan_ip: "192.168.1.10"
#    tailscale_ip: "192.168.1.10"

# Blocklist Configuration
dns_blocklists_enabled: true
dns_blocklists:
  - "https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts"
  - "https://someonewhocares.org/hosts/zero/hosts"
  - "https://raw.githubusercontent.com/AdguardTeam/AdguardSDNSFilter/master/Filters/filter.txt"

# Allowlist - domains that should never be blocked
dns_allowlist:
  - "github.com"
  - "githubusercontent.com"
  - "*.github.io"

# Firewall configuration (optional)
dns_firewall_enable: false  # Set to true to configure UFW rules

# Local resolver configuration
dns_update_resolv_conf: true  # Update /etc/resolv.conf to use local DNS
dns_resolver_nameservers:
  - "127.0.0.1"               # Unbound listens locally
  - "{{ dns_split_lan_ip }}"  # Host LAN IP as fallback
dns_resolver_search_domains: []  # Optional search domains (e.g., ["home.xn--wersdrfer-47a.de"])
dns_resolver_options:
  - "edns0"
  - "trust-ad"

# DDNS Configuration
dns_ddns_enabled: false                          # Opt-in feature
dns_ddns_provider: "gandi"                       # Currently only Gandi supported
dns_ddns_domain: "CHANGEME"                      # Base domain (e.g., "example.com")
dns_ddns_subdomain: "home"                       # Subdomain to update
dns_ddns_update_wildcard: true                   # Also update *.subdomain
dns_ddns_ttl: 300                                # DNS TTL in seconds
dns_ddns_interval: "5min"                        # Update interval
dns_ddns_log_dir: "/var/log/ddns"                # Log directory
dns_ddns_config_dir: "/etc/ddns"                 # Config directory
dns_ddns_script_path: "/usr/local/bin/ddns-update.sh"  # Script location
dns_ddns_api_token: "CHANGEME"                   # Gandi API token (from secrets)
dns_ddns_ipv4_enabled: true                      # Update IPv4 (A records)
dns_ddns_ipv6_enabled: true                      # Update IPv6 (AAAA records)
dns_ddns_log_max_size_mb: 10                     # Log rotation size
