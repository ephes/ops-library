---
# Finalize local resolver configuration after Pi-hole is installed and verified

- block:
    - name: Stop and disable systemd-resolved (if present)
      systemd:
        name: systemd-resolved
        state: stopped
        enabled: false
      failed_when: false  # May not exist on all systems

    - name: Point /etc/resolv.conf at local resolver
      copy:
        content: |
          # Local DNS resolver (Pi-hole â†’ Unbound)
          nameserver 127.0.0.1
        dest: /etc/resolv.conf

    - name: Inform about resolver change
      debug:
        msg:
          - "/etc/resolv.conf now points to 127.0.0.1"
          - "Update DHCP/server settings accordingly."
  when: dns_configure_local_resolver | default(true)

- name: Reminder when resolver change is skipped
  debug:
    msg:
      - "Local resolver configuration skipped (dns_configure_local_resolver=false)."
      - "Update DHCP or /etc/resolv.conf manually if required."
  when: not (dns_configure_local_resolver | default(true))
