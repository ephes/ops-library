---
- name: main | Validate removal settings
  ansible.builtin.import_tasks: validate.yml

- name: main | Stop Open WebUI systemd service
  ansible.builtin.systemd:
    name: "{{ open_webui_service_name }}"
    state: stopped
    enabled: false
    daemon_reload: true
  failed_when: false

- name: main | Remove Open WebUI systemd unit
  ansible.builtin.file:
    path: "/etc/systemd/system/{{ open_webui_service_name }}.service"
    state: absent
  notify: reload systemd

- name: main | Remove Open WebUI Traefik configuration
  ansible.builtin.file:
    path: "{{ open_webui_traefik_config_path }}"
    state: absent
  when: open_webui_remove_traefik_config | bool
  notify: reload traefik

- name: main | Remove Open WebUI env file
  ansible.builtin.file:
    path: "{{ open_webui_env_path }}"
    state: absent
  when: open_webui_remove_env_file | bool

- name: main | Remove Open WebUI venv directory
  ansible.builtin.file:
    path: "{{ open_webui_venv_path }}"
    state: absent
  when: open_webui_remove_venv | bool

- name: main | Remove Open WebUI site directory
  ansible.builtin.file:
    path: "{{ open_webui_site_dir }}"
    state: absent
  when: open_webui_remove_site_dir | bool

- name: main | Remove Open WebUI data directory
  ansible.builtin.file:
    path: "{{ open_webui_data_dir }}"
    state: absent
  when: open_webui_remove_data | bool

- name: main | Remove Open WebUI log directory
  ansible.builtin.file:
    path: "{{ open_webui_log_dir }}"
    state: absent
  when: open_webui_remove_log_dir | bool

- name: main | Remove Open WebUI user
  ansible.builtin.user:
    name: "{{ open_webui_user }}"
    state: absent
    remove: true
  when: open_webui_remove_user | bool

- name: main | Remove Open WebUI group
  ansible.builtin.group:
    name: "{{ open_webui_group }}"
    state: absent
  when: open_webui_remove_group | bool

- name: main | Apply pending handlers
  ansible.builtin.meta: flush_handlers
