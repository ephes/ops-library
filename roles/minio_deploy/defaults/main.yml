---
# MinIO deployment role defaults
# These are safe defaults that can be public
# Sensitive values should be overridden in ops-control

# User, paths
minio_user: minio
minio_group: minio
minio_home: /home/minio
minio_bin_path: /usr/local/bin/minio

# Binary installation (SECURITY: Version pinning required for reproducible deployments)
minio_version: "RELEASE.2025-10-15T17-29-55Z.hotfix.c392ab039"  # REQUIRED - explicit version
minio_checksum: "sha256:2d88210a1e5750a5291d5af9c386a7f3d42c426f77c9446c0bad821b4f5391c4"
minio_download_track: "{{ 'hotfixes' if '.hotfix.' in minio_version else 'release' }}"
minio_download_url: >-
  https://dl.min.io/server/minio/{{ minio_download_track }}/linux-amd64/archive{{
  '/archive' if minio_download_track == 'hotfixes' else '' }}/minio.{{ minio_version }}

minio_config_dir: /etc/minio
minio_env_file: /etc/default/minio
minio_service_unit: /etc/systemd/system/minio.service
minio_certs_dir: "{{ minio_config_dir }}/certs"  # certs/public.crt, certs/private.key

# Data layout (single-node baseline)
# For single-node setups with encrypted storage, prefer a single path:
minio_data_dirs:
  - /var/lib/minio/data
# Note: On a single disk MinIO runs without erasure coding. To expand later, add a new pool
# (separate nodes/drives) rather than adding more dirs to the same disk.

# Network
minio_bind_host: 127.0.0.1
minio_api_port: 9001
minio_console_port: 9002

# Traefik exposure configuration
minio_expose_via_traefik: false
minio_traefik_host: "minio.home.example.com"  # Console host
minio_traefik_api_host: "s3.{{ minio_traefik_host }}"  # S3 API host
minio_traefik_cert_resolver: ""  # empty -> use file-provider certs
minio_traefik_config_path: "/etc/traefik/dynamic/minio.yml"

# Traefik dual router authentication (Console Web UI only)
# API endpoint does not use basic auth (S3 credentials in requests)
minio_console_basic_auth_enabled: true
minio_console_basic_auth_user: "admin"
# REQUIRED when basic auth enabled - Must be provided via SOPS, no default for security
# minio_console_basic_auth_password: "CHANGEME"

# Internal network IP ranges (for dual router pattern - no auth on these IPs)
minio_internal_ip_ranges:
  - "192.168.0.0/16"      # RFC1918 private
  - "10.0.0.0/8"          # RFC1918 private
  - "172.16.0.0/12"       # RFC1918 private
  - "100.64.0.0/10"       # Tailscale CGNAT
  - "fd7a:115c:a1e0::/48" # Tailscale IPv6

# TLS (deliver certificates via SOPS as PEM content)
minio_tls_enable: false
minio_tls_cert_content: ""    # PEM certificate content (from SOPS), not a path
minio_tls_key_content: ""     # PEM private key content (from SOPS), not a path

# Server-side encryption (SSE) â€” optional when full-disk encryption (LUKS) is used
minio_sse_enabled: false
minio_sse_master_key: ""   # 32-byte key; enable only if you need per-object encryption/replication security

# Credentials (override via ops-control secrets)
minio_root_user: "CHANGEME"        # REQUIRED via SOPS
minio_root_password: "CHANGEME"    # REQUIRED via SOPS

# MinIO Client (mc) for bootstrap (SECURITY: Version pinning required)
minio_bootstrap_with_mc: false  # Opt-in - set to true to enable bucket/policy bootstrap
minio_mc_version: "RELEASE.2025-08-13T08-35-41Z"  # REQUIRED if bootstrap enabled
minio_mc_checksum: "sha256:01f866e9c5f9b87c2b09116fa5d7c06695b106242d829a8bb32990c00312e891"  # Get from https://dl.min.io/client/mc/release/linux-amd64/archive/
minio_mc_download_url: "https://dl.min.io/client/mc/release/linux-amd64/archive/mc.{{ minio_mc_version }}"
minio_mc_bin_path: /usr/local/bin/mc
minio_host_alias: local

# Buckets and policies (optional bootstrap - requires minio_bootstrap_with_mc: true)
minio_buckets: []
# - name: backups
#   versioning: true
#   lifecycle: []    # raw JSON rules or simplified schema
#   policy: private  # private|readonly|writeonly|public|custom
#   custom_policy_json: {}

minio_service_accounts: []
# - name: echoport
#   access_key: ""       # REQUIRED via SOPS
#   secret_key: ""       # REQUIRED via SOPS
#   policy: readonly
#   allowed_buckets:
#     - backups

# Health & service
minio_systemd_restart: always
minio_healthcheck_timeout: 30
minio_systemd_memory_max: ""     # e.g., "2G" (optional cgroup limit)
minio_systemd_limit_nofile: 65536 # raise ulimit for many objects
minio_systemd_tasks_max: "infinity"

# Config backup (env, certs, policies export)
minio_backup_config_enable: false  # Consider disabling - may be out of scope
minio_backup_config_dir: /var/backups/minio-config
